(()=>{"use strict";const e=e=>{const t=document.getElementById("table"),n=document.getElementById("typeItem");let s=[];if(t){t.innerHTML="",n.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n                <tr data-key="${e.id}" class="table__row">\n                    <td class="table__id table__cell">${e.id}</td>\n                    <td class="table-type table__cell">${e.type}</td>\n                    <td class="table-name table__cell">\n                        ${e.name}\n                    </td>\n                    <td class="table-units table__cell">\n                        ${e.units}\n                    </td>\n                    <td class="table-cost table__cell">\n                        ${e.cost} руб\n                    </td>\n                    <td>\n                        <div class="table__actions table__cell">\n                            <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change"><use xlink:href="./img/sprite.svg#change"></use></svg></span><span>Изменить</span>\n                            </button>\n                            <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove"><use xlink:href="./img/sprite.svg#remove"></use></svg></span><span>Удалить</span>\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n                \n            `),s.push(e.type)}));let o=Array.from(new Set(s));n.insertAdjacentHTML("beforeend",'\n            <option value="Все услуги">Все услуги</option>  \n        '),o.forEach((e=>{n.insertAdjacentHTML("beforeend",`\n                <option value="${e}">${e}</option>  \n            `)})),n.addEventListener("change",(()=>{t.querySelectorAll(".table__row").forEach((e=>{-1==e.innerHTML.search(`${n.value}`)&&"Все услуги"!=n.value?e.style.display="none":e.style.display=""}))}))}};window.userService=new class{getUsers(){return fetch("http://localhost:4545/users").then((e=>e.json()))}addUser(e){return fetch("http://localhost:4545/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json()))}removeUser(e){return fetch(`http://localhost:4545/users/${e}`,{method:"DELETE"}).then((e=>e.json()))}changeUser(e,t){return fetch(`http://localhost:4545/users/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json()))}getUser(e){return fetch(`http://localhost:4545/users/${e}`).then((e=>e.json()))}editUser(e,t){return document.querySelector(".modal > form").classList.contains("add-form")?fetch("http://localhost:4545/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())):fetch(`http://localhost:4545/users/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json()))}},window.loginService=new class{getUsers(){return fetch("http://localhost:4545/password").then((e=>e.json()))}},userService.getUsers().then((t=>{e(t)})),loginService.getUsers().then((e=>{(e=>{const t=document.getElementById("name"),n=document.querySelector('input[type="password"]'),s=document.querySelector(".main-form > form");if(s){const o=s.querySelectorAll("input");s.querySelectorAll("span")[0].style.display="none",s.querySelectorAll("span")[1].style.display="none",o.forEach((e=>{e.addEventListener("input",(e=>{s.querySelectorAll("span")[0].style.display="none",s.querySelectorAll("span")[1].style.display="none"}))})),s.addEventListener("submit",(o=>{o.preventDefault(),e.forEach((e=>{e.admin==t.value&&e.password==n.value?(t.value="",n.value="",document.location.href=`${document.location.href}table.html`,document.cookie="login = true"):(s.querySelectorAll("span")[0].style.display="",s.querySelectorAll("span")[1].style.display="",t.value="",n.value="")}))}))}})(e)})),"/admin/table.html"!=document.location.pathname&&"/dist/admin/table.html"!=document.location.pathname||/login=true/g.test(document.cookie)||(/dist/g.test(document.location.pathname)?document.location.href=`${document.location.protocol}//${document.location.host}/dist/admin/`:document.location.href=`${document.location.protocol}//${document.location.host}/admin/`),"/admin/table.html"!=document.location.pathname&&"/dist/admin/table.html"!=document.location.pathname||((()=>{const t=document.querySelector(".modal > form"),n=t.querySelector("#type"),s=t.querySelector("#name"),o=t.querySelector("#units"),a=t.querySelector("#cost"),l=document.body;t.querySelectorAll("input").forEach((e=>{e.setAttribute("required","")})),l.addEventListener("click",(e=>{e.target.closest("button.btn-addItem")&&(document.querySelector("#modal").style.display="flex"),e.target.closest("button.button__close")&&(document.querySelector("#modal").style.display="",t.classList.add("add-form"),t.reset())})),t.addEventListener("submit",(l=>{if(l.preventDefault(),!t.dataset.method){const l={type:n.value,name:s.value,units:o.value,cost:a.value,id:Math.floor(9999999999*Math.random())+1e9};userService.addUser(l).then((()=>{userService.getUsers().then((n=>{e(n),t.reset()}))}))}}))})(),document.getElementById("table").addEventListener("click",(t=>{if(t.target.closest(".action-remove")){const n=t.target.closest("tr").dataset.key;userService.removeUser(n).then((t=>{userService.getUsers().then((t=>{e(t)}))}))}})),(()=>{const t=document.getElementById("table"),n=document.querySelector(".modal > form"),s=n.querySelector("#type"),o=n.querySelector("#name"),a=n.querySelector("#units"),l=n.querySelector("#cost");n.classList.contains("add-form")?n.addEventListener("submit",(t=>{if(t.preventDefault(),!n.dataset.method){const t={type:s.value,name:o.value,units:a.value,cost:l.value,id:Math.floor(9999999999*Math.random())+1e9};userService.addUser(t).then((()=>{userService.getUsers().then((t=>{e(t),n.reset()}))}))}})):(t.addEventListener("click",(e=>{if(e.target.closest(".action-change")){document.querySelector(".modal__header").textContent="Редактировать услугу",document.querySelector("#modal").style.display="flex",n.classList.remove("add-form");const t=e.target.closest("tr").dataset.key;userService.getUser(t).then((e=>{s.value=e.type,o.value=e.name,a.value=e.units,l.value=e.cost,n.dataset.method=t}))}})),n.addEventListener("submit",(t=>{if(t.preventDefault(),n.dataset.method){const t=n.dataset.method,r={type:s.value,name:o.value,units:a.value,cost:l.value};userService.editUser(t,r).then((()=>{userService.getUsers().then((t=>{e(t),n.reset(),n.removeAttribute("data-method")}))}))}})))})())})();